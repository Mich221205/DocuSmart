<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DocuSmart - Inicio</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/styleHome.css">
</head>
<body>
  <header>
    <div class="logo">
      <h1>DocuSmart</h1>
    </div>
    <nav class="nav">
      <a href="home.html">Inicio</a>
      <a href="perfil.html">Mi Perfil</a>
      <a href="index.html">Cerrar Sesión</a>
    </nav>
  </header>

  <div class="container">
    <div class="search-box">
      <input type="text" placeholder="Buscar documentales...">
    </div>
    <h2>Recomendaciones para ti</h2>
    <div class="recommendations">
      <!-- Las recomendaciones reales se insertarán aquí dinámicamente -->
    </div>

  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "index.html"; // redirige si no hay sesión
      return;
    }

    fetch("http://localhost:3000/perfil", {
      headers: {
        Authorization: `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(user => {
      const idUsuario = user.ID_USUARIO;
      return fetch(`http://localhost:3000/recomendaciones/${idUsuario}`);

    })
    .then(res => res.json())
    .then(documentales => {
      const contenedor = document.querySelector(".recommendations");
      contenedor.innerHTML = ""; // limpiar las tarjetas actuales

      if (documentales.length === 0) {
        contenedor.innerHTML = "<p>No hay recomendaciones por ahora.</p>";
        return;
      }

      documentales.forEach(doc => {
        const card = document.createElement("div");
        card.classList.add("card");

        const img = document.createElement("img");
        img.src = doc.ruta_imagen || "img/default.png"; // imagen por defecto si no hay
        img.alt = doc.TITULO;

        const content = document.createElement("div");
        content.classList.add("card-content");

        content.innerHTML = `
          <h3>${doc.TITULO}</h3>
          <p>Categoría: ${doc.GENERO}</p>
          <a href="detalle.html?id=${doc.ID_DOCUMENTAL}"><button>Ver más</button></a>
        `;

        card.appendChild(img);
        card.appendChild(content);
        contenedor.appendChild(card);
      });
    })
    .catch(err => {
      console.error("❌ Error cargando recomendaciones:", err);
    });
  });
</script>


</body>
</html>
